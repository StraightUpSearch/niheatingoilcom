# ğŸš€ Production Deployment Guide - Local by Flywheel

## âœ… CURRENT DEPLOYMENT METHOD

**We deploy using Local by Flywheel's "Push to Live" feature.**

âŒ **NOT USING**: GitHub auto-deploy, Railway, Render, Heroku
âœ… **USING**: Local by Flywheel â†’ Live WordPress hosting

---

## ğŸ“‹ Deployment Workflow

### 1. **Development** (Local by Flywheel)

All development happens locally using Local by Flywheel:

```
Site: niheatingoil.local
Location: C:\Users\user\Local Sites\niheatingoil\app\public\
Theme Path: wp-content/themes/ni-heating-oil-theme/
```

### 2. **Build Assets**

Before deploying, rebuild frontend assets:

```bash
cd "C:\Users\user\Local Sites\niheatingoil\app\public\wp-content\themes\ni-heating-oil-theme"
npm run build
```

This creates optimized production files in `/dist/public/`:
- React app bundle
- CSS styles
- Images and assets
- Vite manifest

### 3. **Git Commit** (Optional - for version control)

```bash
git add .
git commit -m "Your changes description"
git push origin main
```

**Note**: GitHub is ONLY used for version control, NOT for deployment.

### 4. **Push to Live** (via Local by Flywheel)

1. **Open Local by Flywheel application**
2. **Select** your `niheatingoil` site
3. **Click "Push to Live"** (or Tools â†’ Push to Live)
4. **Select what to push**:
   - âœ… Theme files (`wp-content/themes/ni-heating-oil-theme/`)
   - âœ… Built assets (`dist/public/`)
   - âœ… Database changes (if any)
5. **Click "Push"** and wait for sync to complete (1-3 minutes)

### 5. **Verify Deployment**

Visit your live site and check:
- âœ… Homepage loads correctly
- âœ… Logo displays in header
- âœ… Navigate to `/compare` - pricing data appears
- âœ… No console errors
- âœ… Suppliers display with prices

---

## ğŸ—ï¸ Architecture Overview

### WordPress + React Hybrid

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Live WordPress Site             â”‚
â”‚       (niheatingoil.com)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚WordPress â”‚         â”‚React/Vite   â”‚
   â”‚  Theme   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Frontend   â”‚
   â”‚(functionsâ”‚         â”‚   (SPA)     â”‚
   â”‚   .php)  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ API Proxy
        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Fallback Data System           â”‚
   â”‚  (5 default suppliers)           â”‚
   â”‚  Budget Heating Oil: Â£499.50     â”‚
   â”‚  Premium Fuel: Â£509.50           â”‚
   â”‚  Express Oil: Â£519.00            â”‚
   â”‚  County Down Oil: Â£524.99        â”‚
   â”‚  North Coast: Â£529.50            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ (optional)
        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚ Express  â”‚  â† Optional backend for
   â”‚ Backend  â”‚    advanced features
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### How It Works

1. **WordPress serves** the React app via `index.php`
2. **React app** makes API calls to `/api/*` endpoints
3. **WordPress proxy** (`functions.php`) tries to reach Express backend
4. **If backend unavailable**: WordPress serves default pricing data
5. **User always sees** functional site with realistic data

---

## ğŸ”§ Key Files

### WordPress Theme Files

```
wp-content/themes/ni-heating-oil-theme/
â”œâ”€â”€ functions.php          # WordPress logic + API proxy + fallback data
â”œâ”€â”€ index.php              # Main template (loads React app)
â”œâ”€â”€ style.css              # Theme header
â”œâ”€â”€ dist/public/           # Built React assets (generated by Vite)
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ index-*.js     # React bundle
â”‚   â”‚   â”œâ”€â”€ index-*.css    # Styles
â”‚   â”‚   â””â”€â”€ *.png          # Images/logo
â”‚   â”œâ”€â”€ .vite/
â”‚   â”‚   â””â”€â”€ manifest.json  # Asset manifest
â”‚   â””â”€â”€ favicon.svg
â”œâ”€â”€ client/                # React source code
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx       # React entry point
â”‚   â”‚   â”œâ”€â”€ App.tsx        # Main app component
â”‚   â”‚   â”œâ”€â”€ components/    # UI components
â”‚   â”‚   â””â”€â”€ pages/         # Page components
â”‚   â””â”€â”€ index.html         # Vite template
â””â”€â”€ server/                # Express backend (optional)
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ routes.ts
    â””â”€â”€ storage.ts
```

### Critical Functions

**functions.php:244-362** - `ni_heating_oil_get_default_prices()`
- Returns 5 default suppliers with realistic pricing
- Activated when Express backend is unavailable

**functions.php:402-422** - API proxy fallback logic
- Tries Express backend first (5 second timeout)
- Falls back to default data if backend down
- Ensures site always functions

---

## ğŸ§ª Testing Checklist

### Before Pushing to Live

- [ ] Run `npm run build` successfully
- [ ] Test locally on `niheatingoil.local`
- [ ] Verify pricing data loads
- [ ] Check logo displays
- [ ] Test navigation (/, /compare, /suppliers)
- [ ] Check browser console for errors
- [ ] Verify mobile responsiveness

### After Pushing to Live

- [ ] Visit `https://niheatingoil.com`
- [ ] Logo appears in header
- [ ] Navigate to `/compare` page
- [ ] See 5 suppliers with prices
- [ ] Click "Get Quote" buttons work
- [ ] No 404/500 errors in console
- [ ] Images load correctly
- [ ] Forms submit successfully

---

## ğŸ”„ Rollback Procedure

If something goes wrong after deployment:

1. **In Local by Flywheel**: Click "Pull from Live"
2. **Restore** to previous version
3. **Test** locally
4. **Push** corrected version

Or manually via FTP/cPanel if needed.

---

## ğŸ“Š Default Pricing Data

WordPress automatically serves these suppliers when Express backend is unavailable:

| Supplier | Volume | Price | Per Litre | Coverage |
|----------|--------|-------|-----------|----------|
| Budget Heating Oil NI | 500L | Â£499.50 | Â£0.999 | NI-wide |
| Premium Fuel Supplies | 500L | Â£509.50 | Â£1.019 | Belfast & surrounding |
| Express Oil Delivery | 500L | Â£519.00 | Â£1.038 | County Antrim |
| County Down Oil Services | 500L | Â£524.99 | Â£1.050 | County Down |
| North Coast Heating | 500L | Â£529.50 | Â£1.059 | Causeway Coast |

**Fallback system ensures**:
- âœ… Site always functional
- âœ… Realistic market prices
- âœ… Geographic coverage across NI
- âœ… No "Unable to load" errors

---

## ğŸš¨ Common Issues & Solutions

### Issue: "Vite manifest not found"

**Cause**: Built assets don't exist
**Solution**:
```bash
npm run build
```
Then push to live again.

---

### Issue: Logo doesn't display

**Cause**: Incorrect asset path
**Check**:
- `index.php` line 67 points to `/dist/public/favicon.svg`
- Logo file exists in `attached_assets/` folder
- Build process copied logo to `dist/public/assets/`

---

### Issue: Pricing data shows old values

**Cause**: Browser cache
**Solution**:
- Hard refresh: `Ctrl + Shift + R` (Windows) or `Cmd + Shift + R` (Mac)
- Clear WordPress cache if using caching plugin

---

### Issue: Changes don't appear on live

**Cause**: Didn't rebuild or push properly
**Solution**:
1. `npm run build` locally
2. Verify `dist/` folder has new timestamps
3. Push to Live via Local by Flywheel
4. Clear browser cache

---

## ğŸ¯ Environment Variables

**NOT REQUIRED** for basic functionality (fallback data works without Express backend).

**Optional** (if running Express backend):

```php
// wp-config.php
define('NI_HEATING_OIL_API_URL', 'http://localhost:5000'); // Development
// OR
define('NI_HEATING_OIL_API_URL', 'https://your-api.railway.app'); // Production

// Email service (optional)
define('SENDGRID_API_KEY', 'your_key');

// Address lookup (optional)
define('GETADDRESS_API_KEY', 'your_key');

// Chatbot (optional)
define('OPENAI_API_KEY', 'your_key');
```

---

## ğŸ“… Deployment History

| Date | Changes | Deployed By |
|------|---------|-------------|
| 2025-10-15 | Fallback pricing data + logo fix | Claude Code |
| 2025-10-14 | Initial WordPress theme integration | Team |
| 2025-10-03 | React app + Express backend | Team |

---

## ğŸ” Security Notes

### Fallback Data
- Supplier phone numbers are placeholders (028 9000 xxxx)
- Website URLs point to niheatingoil.com
- Data refreshes on each API call with `current_time('mysql')`

### Production Best Practices
- âœ… Keep `wp-config.php` secure (never commit to Git)
- âœ… Use strong database passwords
- âœ… Regular WordPress security updates
- âœ… SSL certificate active (HTTPS)
- âœ… Regular backups via hosting provider

---

## ğŸ“ Support

**Development Team**: Review this document before each deployment
**WordPress Hosting**: Contact hosting provider for server issues
**Local by Flywheel**: https://localwp.com/help-docs/

---

## âœ… Quick Reference

**Build command**: `npm run build`
**Deploy method**: Local by Flywheel â†’ Push to Live
**Live site**: https://niheatingoil.com
**Git repo**: https://github.com/StraightUpSearch/niheatingoilcom (version control only)

---

**Last Updated**: October 15, 2025
**Status**: ğŸŸ¢ LIVE and functional with fallback data system
