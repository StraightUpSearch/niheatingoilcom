# 🚀 Production Deployment Guide - Local by Flywheel

## ✅ CURRENT DEPLOYMENT METHOD

**We deploy using Local by Flywheel's "Push to Live" feature.**

❌ **NOT USING**: GitHub auto-deploy, Railway, Render, Heroku
✅ **USING**: Local by Flywheel → Live WordPress hosting

---

## 📋 Deployment Workflow

### 1. **Development** (Local by Flywheel)

All development happens locally using Local by Flywheel:

```
Site: niheatingoil.local
Location: C:\Users\user\Local Sites\niheatingoil\app\public\
Theme Path: wp-content/themes/ni-heating-oil-theme/
```

### 2. **Build Assets**

Before deploying, rebuild frontend assets:

```bash
cd "C:\Users\user\Local Sites\niheatingoil\app\public\wp-content\themes\ni-heating-oil-theme"
npm run build
```

This creates optimized production files in `/dist/public/`:
- React app bundle
- CSS styles
- Images and assets
- Vite manifest

### 3. **Git Commit** (Optional - for version control)

```bash
git add .
git commit -m "Your changes description"
git push origin main
```

**Note**: GitHub is ONLY used for version control, NOT for deployment.

### 4. **Push to Live** (via Local by Flywheel)

1. **Open Local by Flywheel application**
2. **Select** your `niheatingoil` site
3. **Click "Push to Live"** (or Tools → Push to Live)
4. **Select what to push**:
   - ✅ Theme files (`wp-content/themes/ni-heating-oil-theme/`)
   - ✅ Built assets (`dist/public/`)
   - ✅ Database changes (if any)
5. **Click "Push"** and wait for sync to complete (1-3 minutes)

### 5. **Verify Deployment**

Visit your live site and check:
- ✅ Homepage loads correctly
- ✅ Logo displays in header
- ✅ Navigate to `/compare` - pricing data appears
- ✅ No console errors
- ✅ Suppliers display with prices

---

## 🏗️ Architecture Overview

### WordPress + React Hybrid

```
┌─────────────────────────────────────────┐
│         Live WordPress Site             │
│       (niheatingoil.com)               │
└─────────────────────────────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
   ┌────▼─────┐         ┌──────▼──────┐
   │WordPress │         │React/Vite   │
   │  Theme   │◄────────┤  Frontend   │
   │(functions│         │   (SPA)     │
   │   .php)  │         └─────────────┘
   └────┬─────┘
        │
        │ API Proxy
        │
   ┌────▼─────────────────────────────┐
   │   Fallback Data System           │
   │  (5 default suppliers)           │
   │  Budget Heating Oil: £499.50     │
   │  Premium Fuel: £509.50           │
   │  Express Oil: £519.00            │
   │  County Down Oil: £524.99        │
   │  North Coast: £529.50            │
   └──────────────────────────────────┘
        │ (optional)
        │
   ┌────▼─────┐
   │ Express  │  ← Optional backend for
   │ Backend  │    advanced features
   └──────────┘
```

### How It Works

1. **WordPress serves** the React app via `index.php`
2. **React app** makes API calls to `/api/*` endpoints
3. **WordPress proxy** (`functions.php`) tries to reach Express backend
4. **If backend unavailable**: WordPress serves default pricing data
5. **User always sees** functional site with realistic data

---

## 🔧 Key Files

### WordPress Theme Files

```
wp-content/themes/ni-heating-oil-theme/
├── functions.php          # WordPress logic + API proxy + fallback data
├── index.php              # Main template (loads React app)
├── style.css              # Theme header
├── dist/public/           # Built React assets (generated by Vite)
│   ├── assets/
│   │   ├── index-*.js     # React bundle
│   │   ├── index-*.css    # Styles
│   │   └── *.png          # Images/logo
│   ├── .vite/
│   │   └── manifest.json  # Asset manifest
│   └── favicon.svg
├── client/                # React source code
│   ├── src/
│   │   ├── main.tsx       # React entry point
│   │   ├── App.tsx        # Main app component
│   │   ├── components/    # UI components
│   │   └── pages/         # Page components
│   └── index.html         # Vite template
└── server/                # Express backend (optional)
    ├── index.ts
    ├── routes.ts
    └── storage.ts
```

### Critical Functions

**functions.php:244-362** - `ni_heating_oil_get_default_prices()`
- Returns 5 default suppliers with realistic pricing
- Activated when Express backend is unavailable

**functions.php:402-422** - API proxy fallback logic
- Tries Express backend first (5 second timeout)
- Falls back to default data if backend down
- Ensures site always functions

---

## 🧪 Testing Checklist

### Before Pushing to Live

- [ ] Run `npm run build` successfully
- [ ] Test locally on `niheatingoil.local`
- [ ] Verify pricing data loads
- [ ] Check logo displays
- [ ] Test navigation (/, /compare, /suppliers)
- [ ] Check browser console for errors
- [ ] Verify mobile responsiveness

### After Pushing to Live

- [ ] Visit `https://niheatingoil.com`
- [ ] Logo appears in header
- [ ] Navigate to `/compare` page
- [ ] See 5 suppliers with prices
- [ ] Click "Get Quote" buttons work
- [ ] No 404/500 errors in console
- [ ] Images load correctly
- [ ] Forms submit successfully

---

## 🔄 Rollback Procedure

If something goes wrong after deployment:

1. **In Local by Flywheel**: Click "Pull from Live"
2. **Restore** to previous version
3. **Test** locally
4. **Push** corrected version

Or manually via FTP/cPanel if needed.

---

## 📊 Default Pricing Data

WordPress automatically serves these suppliers when Express backend is unavailable:

| Supplier | Volume | Price | Per Litre | Coverage |
|----------|--------|-------|-----------|----------|
| Budget Heating Oil NI | 500L | £499.50 | £0.999 | NI-wide |
| Premium Fuel Supplies | 500L | £509.50 | £1.019 | Belfast & surrounding |
| Express Oil Delivery | 500L | £519.00 | £1.038 | County Antrim |
| County Down Oil Services | 500L | £524.99 | £1.050 | County Down |
| North Coast Heating | 500L | £529.50 | £1.059 | Causeway Coast |

**Fallback system ensures**:
- ✅ Site always functional
- ✅ Realistic market prices
- ✅ Geographic coverage across NI
- ✅ No "Unable to load" errors

---

## 🚨 Common Issues & Solutions

### Issue: "Vite manifest not found"

**Cause**: Built assets don't exist
**Solution**:
```bash
npm run build
```
Then push to live again.

---

### Issue: Logo doesn't display

**Cause**: Incorrect asset path
**Check**:
- `index.php` line 67 points to `/dist/public/favicon.svg`
- Logo file exists in `attached_assets/` folder
- Build process copied logo to `dist/public/assets/`

---

### Issue: Pricing data shows old values

**Cause**: Browser cache
**Solution**:
- Hard refresh: `Ctrl + Shift + R` (Windows) or `Cmd + Shift + R` (Mac)
- Clear WordPress cache if using caching plugin

---

### Issue: Changes don't appear on live

**Cause**: Didn't rebuild or push properly
**Solution**:
1. `npm run build` locally
2. Verify `dist/` folder has new timestamps
3. Push to Live via Local by Flywheel
4. Clear browser cache

---

## 🎯 Environment Variables

**NOT REQUIRED** for basic functionality (fallback data works without Express backend).

**Optional** (if running Express backend):

```php
// wp-config.php
define('NI_HEATING_OIL_API_URL', 'http://localhost:5000'); // Development
// OR
define('NI_HEATING_OIL_API_URL', 'https://your-api.railway.app'); // Production

// Email service (optional)
define('SENDGRID_API_KEY', 'your_key');

// Address lookup (optional)
define('GETADDRESS_API_KEY', 'your_key');

// Chatbot (optional)
define('OPENAI_API_KEY', 'your_key');
```

---

## 📅 Deployment History

| Date | Changes | Deployed By |
|------|---------|-------------|
| 2025-10-15 | Fallback pricing data + logo fix | Claude Code |
| 2025-10-14 | Initial WordPress theme integration | Team |
| 2025-10-03 | React app + Express backend | Team |

---

## 🔐 Security Notes

### Fallback Data
- Supplier phone numbers are placeholders (028 9000 xxxx)
- Website URLs point to niheatingoil.com
- Data refreshes on each API call with `current_time('mysql')`

### Production Best Practices
- ✅ Keep `wp-config.php` secure (never commit to Git)
- ✅ Use strong database passwords
- ✅ Regular WordPress security updates
- ✅ SSL certificate active (HTTPS)
- ✅ Regular backups via hosting provider

---

## 📞 Support

**Development Team**: Review this document before each deployment
**WordPress Hosting**: Contact hosting provider for server issues
**Local by Flywheel**: https://localwp.com/help-docs/

---

## ✅ Quick Reference

**Build command**: `npm run build`
**Deploy method**: Local by Flywheel → Push to Live
**Live site**: https://niheatingoil.com
**Git repo**: https://github.com/StraightUpSearch/niheatingoilcom (version control only)

---

**Last Updated**: October 15, 2025
**Status**: 🟢 LIVE and functional with fallback data system
